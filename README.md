SpaNiche is designed to analyze spatial transcriptome data in tumors and other tissues, focusing on the detection of spatial colocalization patterns and cellular interactions.

## Installation

    devtools::install_github("SiyuanHuang1/SpaNiche")

The following code has been successfully tested on a personal Windows
computer (R version 4.2.1) and on a Linux-based server (R version
4.2.3). It is also compatible with other R environments.

## Input Data

The core algorithm of SpaNiche requires two input matrices:

-   a smoothed cell type abundance matrix

-   a ligand-receptor expression matrix

Taking spatial transcriptomics data generated by the 10X Visium platform
as an example, running spaceranger produces a spatial folder containing
image and coordinate information, as well as a
filtered\_feature\_bc\_matrix.h5 file containing gene expression
profiles.

1.  Using existing spatial transcriptomics deconvolution tools (e.g.,
    cell2location), one can infer the cell type abundance information.

2.  Based on known ligand–receptor interaction databases and expression
    profiles, the ligand–receptor expression matrix can be constructed
    (with built-in functions provided in SpaNiche).

## Niche Detection

    library(SpaNiche)
    library(Seurat)
    library(tidyverse)


    vis.seu=Load10X_Spatial("./example/ST-colon3/")
    vis.seu=NormalizeData(vis.seu)
    vis.seu@meta.data$SB=rownames(vis.seu@meta.data)
    spatialdf=vis.seu@images$slice1@coordinates
    spatialdf$col = spatialdf$col / (3 ^ 0.5)

    tmppath1 = "./example/ST-colon3/cell2location_map/res_spotXcelltype.csv"
    enrichmentdf=read.csv(tmppath1,header = T,row.names = 1,check.names = F)

    if (identical(colnames(vis.seu),rownames(spatialdf))) {
      if(identical(colnames(vis.seu),rownames(enrichmentdf))) {
        print("SB is ok!")
      }
    }


    res.list = spatme_nmf(
      vis.seu,
      spatialdf,
      enrichmentdf,
      smoothing_type = c("loop0", "loop1", "loop1+loop2"),
      distance_thre = c(NA,round(2/(3^0.5),2),round(4/(3^0.5),2)),
      LRDB = SpaNiche::CellChatDB.human,
      LR_dm_type = c("loop1", "loop2"),
      LR_distance_thre = c(round(2/(3^0.5),2),round(4/(3^0.5),2)),
      topic_num = 15,
      defined_weight = c(0.6,0.4),
      lambda_v = 0.5,
      sigma_v = 0.5,
      maxiter = 200,
      st.count = 20
    )
